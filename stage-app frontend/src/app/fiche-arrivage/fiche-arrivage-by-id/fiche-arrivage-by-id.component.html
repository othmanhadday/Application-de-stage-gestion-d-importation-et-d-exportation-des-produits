<div *ngIf="showLoadingIndicator" class="loading">Loadinghhhhh</div>

<div *ngIf="authService.user && authService.user.role && ficheArrivage">
  <!--  // inform other services to activate fiche arrivage-->
  <div class="card"
       *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'">
    <div class="card-body">
      <div class="row">
        <div class="col-md-2">
          Service Achat Nveau 1 :
          <div *ngIf="ficheArrivage.activteArticleSerAchat1">
            <i class="fa fa-check" style="color: #1ef100"></i>
          </div>
          <div *ngIf="!ficheArrivage.activteArticleSerAchat1">
            <button class="btn btn-warning" (click)="informSerAchat1()">
              <i class="fa fa-exclamation-triangle"></i>
            </button>
          </div>
        </div>
        <div class="col-md-2">
          Service Achat Nveau 0 :
          <div *ngIf="ficheArrivage.activteArticleSerAchat0">
            <i class="fa fa-check" style="color: #1ef100"></i>
          </div>
          <div *ngIf="!ficheArrivage.activteArticleSerAchat0">
            <button class="btn btn-warning" (click)="informSerAchat0()">
              <i class="fa fa-exclamation-triangle"></i>
            </button>
          </div>
        </div>
        <div class="col-md-2">
          Service Transitaire Nveau 0 :
          <div *ngIf="ficheArrivage.activteArticleSerTransitaire0">
            <i class="fa fa-check" style="color: #1ef100"></i>
          </div>
          <div *ngIf="!ficheArrivage.activteArticleSerTransitaire0">
            <button class="btn btn-warning" (click)="informSerTransitaire0()">
              <i class="fa fa-exclamation-triangle"></i>
            </button>
          </div>
        </div>
        <div class="col-md-2">
          Service Info Nveau 1 :
          <div *ngIf="ficheArrivage.activteArticleSerInfo1">
            <i class="fa fa-check" style="color: #1ef100"></i>
          </div>
          <div *ngIf="!ficheArrivage.activteArticleSerInfo1">
            <button class="btn btn-warning" (click)="informSerInfo1()">
              <i class="fa fa-exclamation-triangle"></i>
            </button>
          </div>
        </div>
        <div class="col-md-2">
          Service Info Nveau 0 :
          <div *ngIf="ficheArrivage.activteArticleSerInfo0">
            <i class="fa fa-check" style="color: #1ef100"></i>
          </div>
          <div *ngIf="!ficheArrivage.activteArticleSerInfo0">
            <button class="btn btn-warning" (click)="informSerInfo0()">
              <i class="fa fa-exclamation-triangle"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-5" class="shadow" style="border-radius: 0px">
    <div class="card-header" style="border-radius: 0px" [class.bg-success]="FicheArrivageValide()==true">
      Fiche Arrivage {{ficheArrivage.id}}

      <div class="float-right" *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Magasinier niveau 2' &&
                                    !ficheArrivage.finishOperation">
        <button class="btn btn-primary" (click)="finishOperation()">
          <a class="fa fa-check"></a>
        </button>
      </div>
      <div class="float-right" *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Magasinier niveau 2' &&
                                    ficheArrivage.finishOperation">
        Operation finish <a class="fa fa-check"></a>
      </div>

      <div class="float-right">
        <td
          *ngIf="!ficheArrivage.activteArticleSerAchat1 &&  authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 1'">
          <button class="btn btn-warning" (click)="SerAchatNiv1ActivateFicheArrivage(ficheArrivage)"><i
            class="fa fa-check-circle"
            style="color: #f15351"></i>
          </button>
        </td>
        <td
          *ngIf="ficheArrivage.activteArticleSerAchat1 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 1'">
          <i class="fa fa-check-circle" style="color: #1ef100"></i>
        </td>

        <td
          *ngIf="!ficheArrivage.activteArticleSerAchat0 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 0'">
          <button class="btn btn-warning" (click)="SerAchatNiv0ActivateFicheArrivage(ficheArrivage)"><i
            class="fa fa-check-circle"
            style="color: #f15351"></i>
          </button>
        </td>
        <td
          *ngIf="ficheArrivage.activteArticleSerAchat0 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 0'">
          <i class="fa fa-check-circle" style="color: #1ef100"></i>
        </td>

        <td
          *ngIf="!ficheArrivage.activteArticleSerTransitaire0 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Transitaire niveau 0'">
          <button class="btn btn-warning" (click)="SerTransitaireNiv0ActivateFicheArrivage(ficheArrivage)"><i
            class="fa fa-check-circle" style="color: #f15351"></i></button>
        </td>
        <td
          *ngIf="ficheArrivage.activteArticleSerTransitaire0 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Transitaire niveau 0'">
          <i class="fa fa-check-circle" style="color: #1ef100"></i>
        </td>

        <td
          *ngIf="!ficheArrivage.activteArticleSerInfo1 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Informatique niveau 1'">
          <button class="btn btn-warning" (click)="SerInformatiqueNiv1ActivateFicheArrivage(ficheArrivage)"><i
            class="fa fa-check-circle" style="color: #f15351"></i></button>
        </td>
        <td
          *ngIf="ficheArrivage.activteArticleSerInfo1 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Informatique niveau 1'">
          <i class="fa fa-check-circle" style="color: #1ef100"></i>
        </td>

        <td
          *ngIf="!ficheArrivage.activteArticleSerInfo0 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Informatique niveau 0'">
          <button class="btn btn-warning" (click)="SerInformatiqueNiv0ActivateFicheArrivage(ficheArrivage)"><i
            class="fa fa-check-circle" style="color: #f15351"></i></button>
        </td>
        <td
          *ngIf="ficheArrivage.activteArticleSerInfo0 && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Informatique niveau 0'">
          <i class="fa fa-check-circle" style="color: #1ef100"></i>
        </td>
      </div>
    </div>
    <div class="card-body">
      <div class="row" *ngIf="ficheArrivage.user">
        <div class="col-md-4">
          Ajouté par : {{ficheArrivage.user.fullName}}
        </div>
        <div class="col-md-4">
          Date : {{ficheArrivage.createdAt | date:'dd/MM/yy HH:mm'}}
        </div>


        <div class="col-md-4">
          <div class="form-group" *ngIf="!ficheArrivage.depot &&
                      authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Magasinier niveau 0'">
            <label for="depot-select">Select Depot : </label>
            <select class="form-control" #mySelect
                    (change)='selectDepot(mySelect.value)' id="depot-select">
              <option selected hidden>Select Depot</option>
              <option *ngFor="let depot of depots" [value]="depot['id']">{{depot.name}}</option>
            </select>
          </div>
          <div *ngIf="ficheArrivage.depot">
            Depot : {{ficheArrivage.depot.name}}
            <i class="fa fa-edit pointer"
               *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Magasinier niveau 0'"
               (click)="editDepot==false ? editDepot=true : editDepot=false"></i>
          </div>
          <div class="form-group" *ngIf="editDepot==true &&
                      authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Magasinier niveau 0'">
            <label for="depot-select-update">Select Depot : </label>
            <select class="form-control" #mySelect
                    (change)='updateDepot(mySelect.value)' id="depot-select-update">
              <option selected hidden>Select Depot</option>
              <option *ngFor="let depot of depots" [value]="depot['id']">{{depot.name}}</option>
            </select>
          </div>
        </div>


      </div>
      <div class=" row mt-4">
        <table class="table" *ngIf="ficheArrivage.articleFicheArrivageAchats">
          <thead>
          <tr>
            <td>Ref Machine</td>
            <td>nom Machine</td>
            <td>image</td>
            <td>Quantite Achat</td>
            <td>Conteneur</td>
          </tr>
          </thead>
          <tbody *ngFor="let artFiche of ficheArrivage.articleFicheArrivageAchats">
          <tr>
            <td>{{artFiche.model.refMachine}}</td>
            <td>{{artFiche.model.nomMachine}}</td>
            <td>
              <a href="{{authService.host+artFiche.model.image}}" data-lightbox="image-1">
                <img src="{{authService.host+artFiche.model.image}}" class="img-thumbnail" height="70"
                     width="70">
              </a>
            </td>
            <td>{{artFiche.quantiteServAchat}}</td>
            <td>{{artFiche.conteneur.numConteneur}}</td>
            <td
              *ngIf="authService.user.role.service.name == 'Service Achat'">
              <button class="btn btn-primary" (click)="showModalToAddImage(artFiche)">
                <a class="fa fa-image"></a>
              </button>
            </td>
            <td
              *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'">
              <button class="btn btn-success" (click)="showModalOfUpdateQteConteneur(artFiche)">
                <a class="fa fa-edit"></a>
              </button>

              <button class="btn btn-danger" (click)="deleteItemOfFicheArrivage(artFiche)">
                <a class="fa fa-trash-o"></a>
              </button>
            </td>

            <!--            Button to go to page transitaire-->
            <td
              *ngIf="authService.user.role.service.name == 'Service Transitaire'">
              <button class="btn btn-primary" (click)="goToFicheArrivageTransitaire(artFiche)">
                <i class="fa fa-arrow-right" aria-hidden="true"></i>
              </button>
            </td>
            <!--            Button to go to page MAgasinier-->
            <!--          service magasinier date d'arrivee depot-->
            <td *ngIf="ficheArrivage.depot && !artFiche.ficheArrivageMagasiniers[0] &&
                       authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Magasinier niveau 2'">
              <button class="btn btn-danger" (click)="dateArriveeConteneurDepot(artFiche)">
                <i class="fa fa-clock-o"></i>
              </button>
            </td>
            <td *ngIf="ficheArrivage.depot && artFiche.ficheArrivageMagasiniers[0] &&  artFiche.ficheArrivageMagasiniers[0].dateArriveDepot &&
                      authService.user && authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Magasinier niveau 2'">
              <i class="fa fa-clock-o" style="color: #1ef100"></i>
            </td>

            <td
              *ngIf="ficheArrivage.depot && artFiche.ficheArrivageMagasiniers[0] &&  artFiche.ficheArrivageMagasiniers[0].dateArriveDepot">
              <div
                *ngIf="authService.user.role.service.name+' '+authService.user.role.niveau.name == 'Service Magasinier niveau 2' ||
                       authService.user.role.service.name+' '+authService.user.role.niveau.name == 'Service Magasinier niveau 1' ||
                       authService.user.role.service.name+' '+authService.user.role.niveau.name == 'Service Magasinier niveau 0' ||
                       manutentionnaireAccessToFicheMaga(artFiche)==true">
                <button class="btn btn-primary" (click)="goToFicheArrivageMagasinier(artFiche)">
                  <i class="fa fa-arrow-circle-right"></i>
                </button>
              </div>
            </td>

          </tr>
          </tbody>
        </table>
        <div class="row">
          <div class="col ">
            <button
              *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'"
              class="btn btn-primary" data-toggle="modal" data-target="#ModalAddModelToFicheArrivage">
              <i class="fa fa-plus"></i>
            </button>
            <button class="btn btn-danger"
                    *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'"
                    (click)="deleteFicheArrivage()">
              Delete Fiche Arrivage
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
  <!--Commentaire -->
  <div *ngIf="ficheArrivage.commentaires">
    <div class="text-center">
      <button (click)="showMoreCommentaire()" class="btn col-md" *ngIf="showmore==false">
        <i class="fa fa-arrow-up" style="font-size:24px;color:#f15351"></i>
      </button>
      <button (click)="showlessCommentaire()" class="btn col-md" *ngIf="showmore==true">
        <i class="fa fa-arrow-down" style="font-size:24px;color:#f15351"></i>
      </button>
    </div>
    <ul class="list-group list-group-flush shadow-sm" style="border-radius: 0px;margin-top: 20px">

      <a *ngFor="let commentaire of ficheArrivage.commentaires | slice:nbrshowCommenteStart:nbrshowCommenteEnd"
         class="list-group-item list-group-item-action flex-column align-items-start m-1">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">{{commentaire.user.fullName}}</h5>
          <small>  {{commentaire.createdAt | date:'dd/MM/yy HH:mm'}}</small>
        </div>
        <p class="mb-1">{{commentaire.commentaire}}</p>
      </a>


    </ul>
    <div class="card-img-bottom m-0 " style="border-radius: 0px">
      <div class="form-group m-0">
    <textarea [(ngModel)]="commentaire.commentaire" class="form-control m-0 shadow-lg" style="border-radius: 0px"
              placeholder="Commenter"></textarea>
        <button class="btn btn-primary shadow" style="border-radius: 0px" (click)="newCommentaire()">commenter</button>
      </div>
    </div>
  </div>
</div>


<!--update chaque item de fiche Arrivage-->
<div class="modal fade" id="EditQteConteneurModal" role="dialog">
  <div class="modal-dialog modal-lg">
    <!-- Modal content-->
    <div class="modal-content" *ngIf="artFiche">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="conteneur-select">Conteneur</label>
              <select class="form-control" id="conteneur-select" [(ngModel)]="artFiche.conteneur.id">
                <option *ngFor="let conteneur of conteneurs" [ngValue]="conteneur.id">
                  {{conteneur.numConteneur}}
                </option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label>Quantite</label>
              <input type="number" [(ngModel)]="artFiche.quantiteServAchat" placeholder="enter quantite : "
                     required="required" class="form-control">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" (click)="updateQteConteneur()">update</button>
      </div>
    </div>
  </div>
</div>


<!--add articles to fiche Arrivage modal-->
<div class="modal fade" id="ModalAddModelToFicheArrivage" data-keyboard="false" data-backdrop="static" tabindex="-1"
     role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title text-left">Ajouter Nouveau Article dans La Fiche Arrivage </h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>

      </div>
      <div class="modal-body">
        <div>
          <div class="my-0 alert-danger alert" *ngIf="error.quantiteServAchat!=null">
            {{error.quantiteServAchat}}
          </div>
          <div class="my-0 alert-danger alert" *ngIf="error.conteneur!=null">
            {{error.conteneur}}
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="cat-select">Select Categorie : </label>
              <select class="form-control" #mySelect
                      (change)='categorieOnSelect(mySelect.value)' id="cat-select">
                <option selected hidden>Select Categories</option>
                <option *ngFor="let cat of categories" [value]="cat['@id']">{{cat.name}}</option>
              </select>
            </div>
          </div>
          <div class="col-md-6" *ngIf="selectshow==true">
            <div class="form-group">
              <label for="art-select">Select Article : </label>
              <select class="form-control" #mySelect
                      (change)='ArticleOnSelect(mySelect.value)' id="art-select">
                <option selected hidden>Select Articles</option>
                <option *ngFor="let article of articlesByCategorie" [value]="article['@id']">{{article.name}}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-3" *ngFor="let model of modelsByArticle">
            <div class="card border-0">
              <div class="card-body">
                <img src="{{authService.host+model.image}}" class="card-img" height="100" width="100">
                <div class="row">
                  <div class="card-title">
                    <div class="text-left">
                      {{model.nomMachine}}
                    </div>
                    <div class="float-right" *ngIf="modelfind(model)!=true">
                      <form #f="ngForm" (ngSubmit)="addModelselectedToNomenclature(f.value,model)">
                        <input type="number" ngModel name="quantite" placeholder="enter quantite : " required="required"
                               class="form-control">

                        <div class="form-group">
                          <select class="form-control" id="conteneur-select-add" name="conteneur" ngModel>
                            <option selected hidden>Select Conteneur</option>
                            <option *ngFor="let conteneur of conteneurs" [ngValue]="conteneur">
                              {{conteneur.numConteneur}}
                            </option>
                          </select>
                        </div>


                        <button type="submit" class="btn btn-warning">
                          <i class="fa fa-check-circle" style="color: #f15351"></i>
                        </button>
                      </form>

                    </div>
                    <div class="float-right" *ngIf="modelfind(model)==true">
                      <i class="fa fa-check-circle" style="color: #1ef100"></i>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <!--        <button type="button" class="btn btn-primary" (click)="confirmAddModelToNomenclature()">Add</button>-->
        <button type="button" class="btn bg-danger" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<!--add image to chaque item de fiche Arrivage-->
<div class="modal fade" id="ModalAddImageToItemsFicheArrivage" role="dialog">
  <div class="modal-dialog modal-lg">
    <!-- Modal content-->
    <div class="modal-content" *ngIf="artFiche">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="my-0 alert-danger alert" *ngIf="error.image!=null">
          {{error.image}}
        </div>
        <div class="row"
             *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'">
          <div class="form-group">
            <label for="imgeOut">Sélectionner image a l'exterieur de conteneur ( Moins de 1 Mo)</label>
            <input type="file" accept='image/*' class="form-control-file" id="imgeOut"
                   (change)="onAddImageOutSideConteneurToFicheArticle($event)" multiple>
          </div>
        </div>
        <div class="row"
             *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name != 'Service Achat niveau 2'">
          <h5>Image Outside Conteneur</h5>
        </div>
        <div class="row" *ngIf="artFiche.imagesOutSide">
          <div class="col-md-3" *ngFor="let u of artFiche.imagesOutSide">
            <a [href]="authService.host+u.name" data-lightbox="image-1">
              <img *ngIf="u.name" [src]="authService.host+u.name" class="img-thumbnail"
                   height="150"
                   width="150">
            </a>
            <button class="btn btn-danger"
                    *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'"
                    (click)="deleteImageOutSideConteneur(u)">
              <a class="fa fa-trash-o"></a>
            </button>
          </div>
        </div>


        <div class="row"
             *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'">
          <div class="form-group">
            <label for="imagein">Sélectionner image a l'interieur de conteneur ( Moins de 1 Mo)</label>
            <input type="file" accept='image/*' class="form-control-file" id="imagein"
                   (change)="onAddImageInSideConteneurToFicheArticle($event)" multiple>
          </div>
        </div>
        <div class="row"
             *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name != 'Service Achat niveau 2'">
          <h5>Image Inside Conteneur</h5>
        </div>
        <div class="row" *ngIf="artFiche.imagesInside">
          <div class="col-md-3" *ngFor="let u of artFiche.imagesInside">
            <a [href]="authService.host+u.name" data-lightbox="image-1">
              <img *ngIf="u.name" [src]="authService.host+u.name" class="img-thumbnail"
                   height="150"
                   width="150">
            </a>
            <button class="btn btn-danger"
                    *ngIf="authService.user.role.service.name +' '+ authService.user.role.niveau.name == 'Service Achat niveau 2'"
                    (click)="deleteImageInSideConteneur(u)">
              <a class="fa fa-trash-o"></a>
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">

      </div>
    </div>
  </div>
</div>





